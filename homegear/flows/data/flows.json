[{"id":"af5f5744.c39ba","type":"tab","namespace":"tab","label":"MySmarthomeAdmin","disabled":false,"info":""},{"id":"f0855ab9.825048","type":"mqtt-in","namespace":"mqtt","z":"af5f5744.c39ba","name":"SetHeatingWeekProfile","topic":"cmdhomegear/SetHeatingWeekProfile","broker":"9c814888.ebc608","loopprevention":false,"looppreventiongroup":"","x":240,"y":250,"wires":[[{"id":"d37cc093.2c0d","port":0},{"id":"5ef4c904.2ade78","port":0}]]},{"id":"d37cc093.2c0d","type":"debug","namespace":"debug","z":"af5f5744.c39ba","name":"","active":true,"console":"debtab","complete":"true","loglevel":"info","x":1110,"y":330,"wires":[]},{"id":"4b1d2fc7.96b23","type":"mqtt-in","namespace":"mqtt","z":"af5f5744.c39ba","name":"RetrieveHeatingWeekProfile","topic":"cmdhomegear/RetrieveHeatingWeekProfile","broker":"9c814888.ebc608","loopprevention":false,"looppreventiongroup":"","x":265,"y":110,"wires":[[{"id":"643dfa2a.586b44","port":0}]]},{"id":"c5cbd9f5.28fac8","type":"function","namespace":"function","z":"af5f5744.c39ba","name":"GetHeatingWeekProfile","func":"$payload = $message['payload'];\n$room = $payload['room'];\n$hg->log(4, \"Get week profile for room \" . $room);\n$peerId;\nif (strcasecmp($room, \"livingroom\") == 0) {\n    $peerId = 5; \n} elseif (strcasecmp($room, \"bedroom\") == 0) {\n    $peerId = 8; \n} elseif (strcasecmp($room, \"kitchen\") == 0) {\n    $peerId = 10; \n} elseif (strcasecmp($room, \"office\") == 0) {\n    $peerId = 1; \n} \n$profile;\n$hg->log(4, \"Get week profile for peerId \" . $peerId);\nif (isset($peerId)) {\n    $profile = $hg->getParamset($peerId, 0);\n    $hg->log(4, \"Data:\\n\" . print_r($profile, TRUE)); \n}\n$result['data'] = $profile;\n$result['room'] = $room;\n$message['payload'] = $result;\nreturn $message;","inputs":1,"outputs":1,"noerr":0,"x":720,"y":50,"wires":[[{"id":"42e7ef4d.eeef6","port":0},{"id":"d37cc093.2c0d","port":0}]]},{"id":"643dfa2a.586b44","type":"json","namespace":"parsers","z":"af5f5744.c39ba","name":"","x":430,"y":40,"wires":[[{"id":"c5cbd9f5.28fac8","port":0},{"id":"d37cc093.2c0d","port":0}]]},{"id":"42e7ef4d.eeef6","type":"json","namespace":"parsers","z":"af5f5744.c39ba","name":"","x":980,"y":60,"wires":[[{"id":"d37cc093.2c0d","port":0},{"id":"359cd4a4.e636ec","port":0}]]},{"id":"359cd4a4.e636ec","type":"mqtt-out","namespace":"mqtt","z":"af5f5744.c39ba","name":"","topic":"msghomegear/GetHeatingWeekProfile","retain":"","broker":"9c814888.ebc608","x":1270,"y":70,"wires":[]},{"id":"5ef4c904.2ade78","type":"json","namespace":"parsers","z":"af5f5744.c39ba","name":"","x":440,"y":350,"wires":[[{"id":"bb2693fe.e1642","port":0},{"id":"d37cc093.2c0d","port":0}]]},{"id":"bb2693fe.e1642","type":"function","namespace":"function","z":"af5f5744.c39ba","name":"PutHeatingWeekProfile","func":"$payload = $message['payload'];\n$room = $payload['room'];\n$data = $payload['data'];\n$hg->log(3, \"Set week profile for room \" . $room);\n$hg->log(4, \"Data:\\n\" . print_r($data, TRUE)); \n$peerId;\nif (strcasecmp($room, \"livingroom\") == 0) {\n    $peerId = 5; \n} elseif (strcasecmp($room, \"bedroom\") == 0) {\n    $peerId = 8; \n} elseif (strcasecmp($room, \"kitchen\") == 0) {\n    $peerId = 10; \n} elseif (strcasecmp($room, \"office\") == 0) {\n    $peerId = 1; \n} \n$result;\n$hg->log(4, \"Set week profile for peerId \" . $peerId);\nif (isset($peerId)) {\n    $hg->log(4, \"Set it now\");\n    $result = $hg->putParamset($peerId, 0, $data);\n}\n$hg->log(4, \"Result=\" . $result);\n$payload['result'] = $result;\n$message['payload'] = $payload;\nreturn $message;","inputs":1,"outputs":1,"noerr":0,"x":690,"y":370,"wires":[[{"id":"1e7a581f.002cd8","port":0}]]},{"id":"1e7a581f.002cd8","type":"json","namespace":"parsers","z":"af5f5744.c39ba","name":"","x":900,"y":380,"wires":[[{"id":"d37cc093.2c0d","port":0},{"id":"3002cdb.1bb7532","port":0}]]},{"id":"3002cdb.1bb7532","type":"mqtt-out","namespace":"mqtt","z":"af5f5744.c39ba","name":"ResultSetHeatingWeekProfile","topic":"msghomegear/GetHeatingWeekProfile","retain":"","broker":"9c814888.ebc608","x":1320,"y":410,"wires":[]},{"id":"7d09dc00.20aee4","type":"mqtt-in","namespace":"mqtt","z":"af5f5744.c39ba","name":"SetParty","topic":"cmdhomegear/SetParty","broker":"9c814888.ebc608","loopprevention":false,"looppreventiongroup":"","x":210,"y":500,"wires":[[{"id":"a8521103.579cc","port":0}]]},{"id":"a8521103.579cc","type":"json","namespace":"parsers","z":"af5f5744.c39ba","name":"","x":400,"y":510,"wires":[[{"id":"5c97aab5.3510e4","port":0},{"id":"21a9acd3.7ee8d4","port":0}]]},{"id":"5c97aab5.3510e4","type":"function","namespace":"function","z":"af5f5744.c39ba","name":"SetPartyToDevice","func":"$hg->log(2, \"Include mapping.php\");\ninclude 'mapping.php';\n$hg->log(2, \"Include party.php\");\ninclude 'party.php';\n$hg->log(2, \"All included\");\n\n$payload = $message['payload'];\n$roomIds = $payload['roomIds'];\n$temperature = $payload['temperature'];\n$until = $payload['until'];\n$year = $until['year'];\n$month = $until['month'];\n$day = $until['day'];\n$hour = $until['hour'];\n$minute = $until['minute'];\nforeach ($roomIds as $roomId) {\n    $hg->log(2, \"RoomId=\" . $roomId);\n    $peerIds = getPeerIdThermostatByRoomId($roomId);\n    $sPeerIds = implode(\",\", $peerIds);\n    $hg->log(2, \"RoomId=\" . $roomId . \" PeerIds=\" . $sPeerIds);\n    foreach($peerIds as $peerId) {\n        $ret = setPartyValues($peerId, $year, $month, $day, $hour, $minute, $temperature);\n        $hg->log(2,\"SetPartyToDevice finished for PeerId=\" . $peerId . \" with result \" . $ret);\n        if ($ret==true) {\n            activatePartyMode($peerId);\n        }\n    }\n}\n$message['payload'] = true;\nreturn $message;","inputs":1,"outputs":1,"noerr":0,"x":700,"y":500,"wires":[[]]},{"id":"21a9acd3.7ee8d4","type":"debug","namespace":"debug","z":"af5f5744.c39ba","name":"","active":true,"console":"debtab","complete":"true","loglevel":"info","x":790,"y":450,"wires":[]},{"id":"9c814888.ebc608","type":"mqtt-broker","namespace":"mqtt","z":"","broker":"localhost","port":"1883","clientid":"","usetls":false}]